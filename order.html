<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>å£²åº—ãƒ»æ³¨æ–‡</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --soft:#f9fafb;

      --radius:16px;
      --shadow: 0 10px 28px rgba(17,24,39,.08);

      --primary:#111827;
      --blue:#2563eb;
      --ok:#16a34a;
      --danger:#dc2626;

      --tap:56px;
      --max:520px;

      --title:22px;
      --label:18px;
      --sub:14px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans JP", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ===== å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå·¦ãªã—ï¼ä¸­å¤®ã‚¿ã‚¤ãƒˆãƒ«ï¼å³ãƒ›ãƒ¼ãƒ ï¼‰ ===== */
    .header{
      height:64px;
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      border-bottom:1px solid var(--line);
      padding:0 16px;
      background:#fff;
      position:sticky;
      top:0;
      z-index:10;
    }
    .header-title{
      grid-column:2;
      font-size: var(--title);
      font-weight: 900;
      text-align:center;
      letter-spacing:.02em;
    }
    .header-home{
      grid-column:3;
      justify-self:end;
      font-size:18px;
      font-weight:900;
      text-decoration:none;
      color: var(--blue);
    }

    .wrap{
      max-width: var(--max);
      margin:0 auto;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background:#fff;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-hd{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
    }
    .card-hd .h{
      font-size:16px;
      font-weight:900;
      color:#374151;
    }
    .pill{
      font-size:12px;
      font-weight:800;
      color: var(--muted);
      border:1px solid var(--line);
      background:#fff;
      padding:8px 10px;
      border-radius:999px;
      white-space:nowrap;
    }

    /* ã‚¿ãƒ– */
    .tabs{
      display:flex;
      gap:10px;
      padding:12px 12px 0;
    }
    .tab{
      flex:1;
      border:1px solid var(--line);
      border-radius:14px;
      height:48px;
      font-size:16px;
      font-weight:900;
      background:#fff;
      cursor:pointer;
    }
    .tab.active{
      background: var(--primary);
      color:#fff;
      border-color: var(--primary);
    }

    /* å•†å“ãƒªã‚¹ãƒˆ */
    .list{ padding:12px; display:flex; flex-direction:column; gap:10px; }
    .item{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:#fff;
    }
    .left{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .name{
      font-size: var(--label);
      font-weight: 900;
      line-height:1.15;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .meta{
      display:flex;
      align-items:center;
      gap:10px;
      font-size: var(--sub);
      color: var(--muted);
      font-weight:800;
    }
    .price{
      font-size: 16px;
      font-weight: 900;
      color:#111827;
    }

    .right{
      display:flex;
      align-items:center;
      gap:10px;
      flex: 0 0 auto;
    }

    .qty{
      display:inline-flex;
      align-items:center;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      height:48px;
      background:#fff;
    }
    .qty button{
      width:48px;
      height:48px;
      border:0;
      background:#fff;
      font-size:22px;
      font-weight:900;
      cursor:pointer;
    }
    .qty button:active{ background:#f3f4f6; }
    .qty .n{
      width:48px;
      text-align:center;
      font-size:18px;
      font-weight:900;
    }

    /* ã‚«ãƒ¼ãƒˆ */
    .cart{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .cartRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
    }
    .cartRow .cname{
      font-size:16px;
      font-weight:900;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .cartRow .csub{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      margin-top:4px;
    }
    .cartRow .cinfo{
      display:flex;
      flex-direction:column;
      min-width:0;
    }
    .cartRow .cright{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
    }
    .del{
      width:44px;height:44px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      font-size:18px;
      cursor:pointer;
    }
    .del:active{ background:#fef2f2; border-color:#fecaca; }

    .sum{
      padding:14px 16px;
      border-top:1px solid var(--line);
      background: var(--soft);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-weight:900;
    }
    .sum .total{
      font-size:20px;
    }

    .actions{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .btn{
      height: var(--tap);
      border-radius:16px;
      border:0;
      font-size:18px;
      font-weight:900;
      cursor:pointer;
      box-shadow: var(--shadow);
    }
    .btn.primary{ background: var(--ok); color:#fff; }
    .btn.secondary{
      background:#fff;
      color: var(--text);
      border:1px solid var(--line);
      box-shadow:none;
      font-weight:900;
    }
    .btn.danger{
      background:#fff;
      color: var(--danger);
      border:1px solid #fecaca;
      box-shadow:none;
      font-weight:900;
    }
    .btn:disabled{
      opacity:.45;
      cursor:not-allowed;
      box-shadow:none;
    }

    .note{
      padding:12px 16px;
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      line-height:1.4;
    }
  </style>
</head>

<body>
  <header class="header">
    <div></div>
    <div class="header-title">å£²åº—ãƒ»æ³¨æ–‡</div>
    <a class="header-home" href="index.html">ãƒ›ãƒ¼ãƒ </a>
  </header>

  <div class="wrap">

    <!-- å•†å“ -->
    <section class="card">
      <div class="card-hd">
        <div class="h">å•†å“</div>
        <div class="pill" id="placePill">å£²åº—</div>
      </div>

      <div class="tabs" role="tablist" aria-label="å£²åº—ãƒ»ãƒ©ã‚¦ãƒ³ã‚¸åˆ‡æ›¿">
        <button class="tab active" id="tabShop" type="button">å£²åº—</button>
        <button class="tab" id="tabLounge" type="button">ãƒ©ã‚¦ãƒ³ã‚¸</button>
      </div>

      <div class="list" id="productList"></div>

      <div class="note">
        â€»ãƒ¢ãƒƒã‚¯ã®ãŸã‚ã€æ³¨æ–‡ã¯ãƒ‡ãƒ¢è¡¨ç¤ºã§ã™ã€‚<br>
        â€»å–ªä¸»/åŒè¡Œè€…ã®è¡¨ç¤ºãƒ»åˆ‡æ›¿ã¯è¡Œã„ã¾ã›ã‚“ï¼ˆè¦ä»¶ã©ãŠã‚Šå‰Šé™¤ï¼‰ã€‚
      </div>
    </section>

    <!-- ã‚«ãƒ¼ãƒˆ -->
    <section class="card">
      <div class="card-hd">
        <div class="h">ã‚«ãƒ¼ãƒˆ</div>
        <div class="pill" id="countPill">0ç‚¹</div>
      </div>

      <div class="cart" id="cart"></div>

      <div class="sum">
        <div>åˆè¨ˆ</div>
        <div class="total" id="total">Â¥0</div>
      </div>

      <div class="actions">
        <button class="btn primary" id="orderBtn" disabled>æ³¨æ–‡ã™ã‚‹</button>
        <button class="btn secondary" id="saveBtn" disabled>æ³¨æ–‡å†…å®¹ã‚’ä¿å­˜</button>
        <button class="btn danger" id="clearBtn" disabled>ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã™ã‚‹</button>
      </div>
    </section>

  </div>

  <script>
    // ===== ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ =====
    const PRODUCTS = {
      shop: [
        { id:"s1", name:"ãŠèŒ¶ï¼ˆãƒšãƒƒãƒˆãƒœãƒˆãƒ«ï¼‰", price:160 },
        { id:"s2", name:"æ°´ï¼ˆãƒšãƒƒãƒˆãƒœãƒˆãƒ«ï¼‰", price:120 },
        { id:"s3", name:"ãŠã—ã¼ã‚Š", price:80 },
        { id:"s4", name:"ã®ã©é£´", price:150 },
        { id:"s5", name:"ãƒãƒ³ã‚«ãƒ", price:300 },
      ],
      lounge: [
        { id:"l1", name:"ã‚³ãƒ¼ãƒ’ãƒ¼", price:350 },
        { id:"l2", name:"ç´…èŒ¶", price:350 },
        { id:"l3", name:"è»½é£Ÿï¼ˆã‚µãƒ³ãƒ‰ï¼‰", price:650 },
        { id:"l4", name:"ãŠã«ãã‚Š", price:280 },
        { id:"l5", name:"ã‚±ãƒ¼ã‚­", price:520 },
      ]
    };

    // ===== çŠ¶æ…‹ =====
    const LS_KEY = "miniapp_cart";
    let place = "shop"; // shop / lounge
    let cart = loadCart(); // {id: qty}

    // ===== è¦ç´  =====
    const listEl = document.getElementById("productList");
    const cartEl = document.getElementById("cart");
    const totalEl = document.getElementById("total");
    const countPill = document.getElementById("countPill");
    const placePill = document.getElementById("placePill");

    const tabShop = document.getElementById("tabShop");
    const tabLounge = document.getElementById("tabLounge");

    const orderBtn = document.getElementById("orderBtn");
    const saveBtn = document.getElementById("saveBtn");
    const clearBtn = document.getElementById("clearBtn");

    // ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
    function yen(n){ return "Â¥" + n.toLocaleString("ja-JP"); }

    function loadCart(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return {};
        const obj = JSON.parse(raw);
        return (obj && typeof obj === "object") ? obj : {};
      }catch{
        return {};
      }
    }
    function persistCart(){
      localStorage.setItem(LS_KEY, JSON.stringify(cart));
    }

    function getAllProducts(){
      return [...PRODUCTS.shop, ...PRODUCTS.lounge];
    }
    function findProduct(id){
      return getAllProducts().find(p => p.id === id);
    }

    function qtyOf(id){ return cart[id] || 0; }

    function setQty(id, qty){
      if(qty <= 0) delete cart[id];
      else cart[id] = qty;
      persistCart();
      render();
    }

    function cartCount(){
      return Object.values(cart).reduce((a,b)=>a+b,0);
    }
    function cartTotal(){
      let sum = 0;
      for(const [id, qty] of Object.entries(cart)){
        const p = findProduct(id);
        if(p) sum += p.price * qty;
      }
      return sum;
    }

    // ===== æç”» =====
    function renderProducts(){
      placePill.textContent = (place === "shop") ? "å£²åº—" : "ãƒ©ã‚¦ãƒ³ã‚¸";
      const items = PRODUCTS[place];

      listEl.innerHTML = items.map(p => {
        const q = qtyOf(p.id);
        return `
          <div class="item">
            <div class="left">
              <div class="name">${escapeHtml(p.name)}</div>
              <div class="meta">
                <span class="price">${yen(p.price)}</span>
              </div>
            </div>
            <div class="right">
              <div class="qty" aria-label="${escapeHtml(p.name)} æ•°é‡">
                <button type="button" data-act="minus" data-id="${p.id}" aria-label="æ¸›ã‚‰ã™">âˆ’</button>
                <div class="n" aria-label="æ•°é‡">${q}</div>
                <button type="button" data-act="plus" data-id="${p.id}" aria-label="å¢—ã‚„ã™">ï¼‹</button>
              </div>
            </div>
          </div>
        `;
      }).join("");

      // ã‚¤ãƒ™ãƒ³ãƒˆå§”è­²
      listEl.querySelectorAll("button[data-act]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-id");
          const act = btn.getAttribute("data-act");
          const cur = qtyOf(id);
          setQty(id, act === "plus" ? cur + 1 : Math.max(0, cur - 1));
        });
      });
    }

    function renderCart(){
      const entries = Object.entries(cart).filter(([id,qty])=>qty>0);

      countPill.textContent = `${cartCount()}ç‚¹`;
      totalEl.textContent = yen(cartTotal());

      const has = entries.length > 0;
      orderBtn.disabled = !has;
      saveBtn.disabled = !has;
      clearBtn.disabled = !has;

      if(!has){
        cartEl.innerHTML = `<div class="note">ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™ã€‚</div>`;
        return;
      }

      cartEl.innerHTML = entries.map(([id, qty])=>{
        const p = findProduct(id);
        if(!p) return "";
        const subtotal = p.price * qty;
        return `
          <div class="cartRow">
            <div class="cinfo">
              <div class="cname">${escapeHtml(p.name)}</div>
              <div class="csub">${yen(p.price)} Ã— ${qty} = ${yen(subtotal)}</div>
            </div>
            <div class="cright">
              <div class="qty" aria-label="${escapeHtml(p.name)} æ•°é‡">
                <button type="button" data-cact="minus" data-id="${id}" aria-label="æ¸›ã‚‰ã™">âˆ’</button>
                <div class="n">${qty}</div>
                <button type="button" data-cact="plus" data-id="${id}" aria-label="å¢—ã‚„ã™">ï¼‹</button>
              </div>
              <button class="del" type="button" data-del="${id}" aria-label="å‰Šé™¤">ğŸ—‘</button>
            </div>
          </div>
        `;
      }).join("");

      cartEl.querySelectorAll("button[data-cact]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-id");
          const act = btn.getAttribute("data-cact");
          const cur = qtyOf(id);
          setQty(id, act === "plus" ? cur + 1 : Math.max(0, cur - 1));
        });
      });

      cartEl.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-del");
          setQty(id, 0);
        });
      });
    }

    function render(){
      renderProducts();
      renderCart();
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== ã‚¿ãƒ–åˆ‡æ›¿ =====
    tabShop.addEventListener("click", ()=>{
      place = "shop";
      tabShop.classList.add("active");
      tabLounge.classList.remove("active");
      renderProducts();
    });

    tabLounge.addEventListener("click", ()=>{
      place = "lounge";
      tabLounge.classList.add("active");
      tabShop.classList.remove("active");
      renderProducts();
    });

    // ===== æ“ä½œ =====
    orderBtn.addEventListener("click", ()=>{
      const total = cartTotal();
      alert(`æ³¨æ–‡ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰\nåˆè¨ˆï¼š${yen(total)}`);
      // ãƒ¢ãƒƒã‚¯ã§ã¯æ³¨æ–‡å¾Œã«ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã—ã¦ã‚‚è‰¯ã„ãŒã€é‹ç”¨æ¬¡ç¬¬ãªã®ã§ä¿å­˜ã¯ç¶­æŒ
    });

    saveBtn.addEventListener("click", ()=>{
      persistCart();
      alert("æ³¨æ–‡å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰ã€‚");
    });

    clearBtn.addEventListener("click", ()=>{
      cart = {};
      persistCart();
      render();
    });

    // åˆæœŸæç”»
    render();
  </script>
</body>
</html>
