<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ã‚ªãƒ¼ãƒ€ãƒ¼</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --soft:#f9fafb;

      --radius:16px;
      --shadow: 0 10px 28px rgba(17,24,39,.08);

      --primary:#111827;
      --blue:#2563eb;
      --ok:#16a34a;
      --danger:#dc2626;

      --tap:56px;
      --max:520px;

      --title:22px;
      --label:18px;
      --sub:14px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans JP", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ===== å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå·¦ãªã—ï¼ä¸­å¤®ã‚¿ã‚¤ãƒˆãƒ«ï¼å³ãƒ›ãƒ¼ãƒ ï¼‹ãƒˆã‚°ãƒ«ï¼‰ ===== */
    .header{
      height:64px;
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      border-bottom:1px solid var(--line);
      padding:0 12px;
      background:#fff;
      position:sticky;
      top:0;
      z-index:10;
      gap:8px;
    }
    .header-title{
      grid-column:2;
      font-size: var(--title);
      font-weight: 900;
      text-align:center;
      letter-spacing:.02em;
    }
    .header-right{
      grid-column:3;
      justify-self:end;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .header-home{
      font-size:18px;
      font-weight:900;
      text-decoration:none;
      color: var(--blue);
      white-space:nowrap;
    }

    /* å½¹å‰²ãƒˆã‚°ãƒ«ï¼ˆå–ªä¸»ï¼åŒè¡Œè€…ï¼‰ */
    .role-switch{
      display:flex;
      gap:4px;
    }
    .role-switch button{
      border:1px solid var(--line);
      background:#fff;
      padding:6px 10px;
      border-radius:10px;
      font-size:12px;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    }
    .role-switch button.active{
      background: var(--primary);
      color:#fff;
      border-color: var(--primary);
    }

    /* ===== åœæ­¢ä¸­ãƒãƒŠãƒ¼ + è¨­å®š ===== */
    .stopBar{
      position:sticky;
      top:64px;
      z-index:9;
      border-bottom:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
    }
    .stopInner{
      max-width: var(--max);
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .stopBadge{
      display:none;
      border:1px solid #fecaca;
      background:#fff1f2;
      color:#991b1b;
      font-weight:900;
      padding:8px 10px;
      border-radius:999px;
      white-space:nowrap;
    }
    .stopToggle{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      color:#374151;
      white-space:nowrap;
    }
    .stopToggle input{ width:20px; height:20px; }

    .wrap{
      max-width: var(--max);
      margin:0 auto;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background:#fff;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-hd{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
    }
    .card-hd .h{
      font-size:16px;
      font-weight:900;
      color:#374151;
    }
    .pill{
      font-size:12px;
      font-weight:800;
      color: var(--muted);
      border:1px solid var(--line);
      background:#fff;
      padding:8px 10px;
      border-radius:999px;
      white-space:nowrap;
    }

    /* å•†å“ãƒªã‚¹ãƒˆ */
    .list{ padding:12px; display:flex; flex-direction:column; gap:10px; }
    .item{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:#fff;
    }
    .left{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .name{
      font-size: var(--label);
      font-weight: 900;
      line-height:1.15;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .meta{
      display:flex;
      align-items:center;
      gap:10px;
      font-size: var(--sub);
      color: var(--muted);
      font-weight:800;
    }
    .price{
      font-size: 16px;
      font-weight: 900;
      color:#111827;
    }

    .right{
      display:flex;
      align-items:center;
      gap:10px;
      flex: 0 0 auto;
    }

    .qty{
      display:inline-flex;
      align-items:center;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      height:48px;
      background:#fff;
    }
    .qty button{
      width:48px;
      height:48px;
      border:0;
      background:#fff;
      font-size:22px;
      font-weight:900;
      cursor:pointer;
    }
    .qty button:active{ background:#f3f4f6; }
    .qty .n{
      width:48px;
      text-align:center;
      font-size:18px;
      font-weight:900;
    }

    /* ã‚«ãƒ¼ãƒˆ */
    .cart{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .cartRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
    }
    .cartRow .cname{
      font-size:16px;
      font-weight:900;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .cartRow .csub{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      margin-top:4px;
    }
    .cartRow .cinfo{
      display:flex;
      flex-direction:column;
      min-width:0;
    }
    .cartRow .cright{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
    }
    .del{
      width:44px;height:44px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      font-size:18px;
      cursor:pointer;
    }
    .del:active{ background:#fef2f2; border-color:#fecaca; }

    .sum{
      padding:14px 16px;
      border-top:1px solid var(--line);
      background: var(--soft);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-weight:900;
    }
    .sum .total{
      font-size:20px;
    }

    .actions{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .btn{
      height: var(--tap);
      border-radius:16px;
      border:0;
      font-size:18px;
      font-weight:900;
      cursor:pointer;
      box-shadow: var(--shadow);
    }
    .btn.primary{ background: var(--ok); color:#fff; }
    .btn.secondary{
      background:#fff;
      color: var(--text);
      border:1px solid var(--line);
      box-shadow:none;
      font-weight:900;
    }
    .btn.danger{
      background:#fff;
      color: var(--danger);
      border:1px solid #fecaca;
      box-shadow:none;
      font-weight:900;
    }
    .btn:disabled{
      opacity:.45;
      cursor:not-allowed;
      box-shadow:none;
    }

    /* ===== ç²¾ç®— ===== */
    .pay{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .payBox{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .payRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      font-weight:900;
    }
    .payRow .label{
      font-size:14px;
      color: var(--muted);
      font-weight:900;
    }
    .payRow .value{
      font-size:20px;
      color: var(--text);
      font-weight:900;
    }
    .qrWrap{
      display:flex;
      justify-content:center;
      padding:10px 0 2px;
    }
    .qr{
      width:220px;
      height:220px;
      border-radius:16px;
      border:1px solid var(--line);
      background:#fff;
      display:grid;
      place-items:center;
      box-shadow: 0 10px 28px rgba(17,24,39,.06);
    }
    .qr svg{ width:200px; height:200px; display:block; }

    .smallNote{
      padding:10px 16px 14px;
      font-size:12px;
      color: var(--muted);
      font-weight:800;
      line-height:1.4;
      text-align:center;
    }

    /* ===== åœæ­¢ä¸­è¦‹ãŸç›®ï¼ˆæ“ä½œä¸å¯ï¼‰ ===== */
    .stopped .item,
    .stopped .cartRow{
      opacity:.65;
    }
    .stopped .qty{
      opacity:.55;
      pointer-events:none;
    }
    .stopped .del{
      pointer-events:none;
      opacity:.6;
    }
  </style>
</head>

<body>
  <header class="header">
    <div></div>
    <div class="header-title">ã‚ªãƒ¼ãƒ€ãƒ¼</div>

    <div class="header-right">
      <div class="role-switch" aria-label="è¡¨ç¤ºåˆ‡æ›¿">
        <button id="btnHost" type="button">å–ªä¸»</button>
        <button id="btnGuest" type="button">åŒè¡Œè€…</button>
      </div>
      <a class="header-home" href="./index.html">ãƒ›ãƒ¼ãƒ </a>
    </div>
  </header>

  <!-- åœæ­¢ä¸­ è¨­å®šãƒãƒ¼ï¼ˆãƒã‚§ãƒƒã‚¯ã§åˆ‡æ›¿ï¼‰ -->
  <div class="stopBar">
    <div class="stopInner">
      <span class="stopBadge" id="stopBadge">ã‚ªãƒ¼ãƒ€ãƒ¼åœæ­¢ä¸­</span>
      <label class="stopToggle">
        <span>ã‚ªãƒ¼ãƒ€ãƒ¼åœæ­¢</span>
        <input id="stopToggle" type="checkbox" />
      </label>
    </div>
  </div>

  <div class="wrap" id="appRoot">

    <!-- å•†å“ -->
    <section class="card">
      <div class="card-hd">
        <div class="h">å•†å“</div>
        <div class="pill">å£²åº—</div>
      </div>
      <div class="list" id="productList"></div>
    </section>

    <!-- ã‚«ãƒ¼ãƒˆ -->
    <section class="card">
      <div class="card-hd">
        <div class="h">ã‚«ãƒ¼ãƒˆ</div>
        <div class="pill" id="countPill">0ç‚¹</div>
      </div>

      <div class="cart" id="cart"></div>

      <div class="sum">
        <div>åˆè¨ˆ</div>
        <div class="total" id="total">Â¥0</div>
      </div>

      <div class="actions">
        <button class="btn primary" id="orderBtn" disabled>æ³¨æ–‡ã™ã‚‹</button>
        <button class="btn secondary" id="saveBtn" disabled>æ³¨æ–‡å†…å®¹ã‚’ä¿å­˜</button>
        <button class="btn danger" id="clearBtn" disabled>ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã™ã‚‹</button>
      </div>

      <!-- ç²¾ç®—ï¼ˆå–ªä¸»ã®ã¿è¡¨ç¤ºï¼‰ -->
      <div id="paySection">
        <div class="card-hd" style="border-top:1px solid var(--line);">
          <div class="h">ç²¾ç®—</div>
          <div class="pill">å–ªä¸»ã®ã¿</div>
        </div>

        <div class="pay">
          <div class="payBox">
            <div class="payRow">
              <div class="label">ç²¾ç®—é‡‘é¡</div>
              <div class="value" id="payTotal">Â¥0</div>
            </div>

            <div class="qrWrap">
              <div class="qr" aria-label="ç²¾ç®—QRã‚³ãƒ¼ãƒ‰">
                <div id="qrHost"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="smallNote">â€»å–ªä¸»ã®ç”»é¢ã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™</div>
      </div>

      <!-- åŒè¡Œè€…ã®ã¨ãã ã‘è¦‹ã›ã‚‹æ³¨è¨˜ -->
      <div class="smallNote" id="guestNote" style="display:none;">
        â€»å–ªä¸»ã®ç”»é¢ã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™
      </div>

    </section>

  </div>

  <script>
    // ===== ãƒ‡ãƒ¢å•†å“ï¼ˆå£²åº—ã®ã¿ï¼‰ =====
    const PRODUCTS = [
      { id:"s1", name:"ãŠèŒ¶ï¼ˆãƒšãƒƒãƒˆãƒœãƒˆãƒ«ï¼‰", price:160 },
      { id:"s2", name:"æ°´ï¼ˆãƒšãƒƒãƒˆãƒœãƒˆãƒ«ï¼‰", price:120 },
      { id:"s3", name:"ãŠã—ã¼ã‚Š", price:80 },
      { id:"s4", name:"ã®ã©é£´", price:150 },
      { id:"s5", name:"ãƒãƒ³ã‚«ãƒ", price:300 },
    ];

    // ===== ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ =====
    const LS_CART = "miniapp_cart";
    const LS_ROLE = "miniapp_role"; // "host" | "guest"
    const LS_ORDER_STOP = "miniapp_order_stop"; // "1"=åœæ­¢, "0"=ç¨¼åƒ

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å–ªä¸»
    if(!localStorage.getItem(LS_ROLE)){
      localStorage.setItem(LS_ROLE, "host");
    }
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€Œåœæ­¢ã€ï¼ˆè¦æœ›é€šã‚Šï¼šåˆæœŸã¯åœæ­¢ä¸­ï¼‰
    if(localStorage.getItem(LS_ORDER_STOP) == null){
      localStorage.setItem(LS_ORDER_STOP, "1");
    }

    // ===== è¦ç´  =====
    const appRoot = document.getElementById("appRoot");
    const stopToggle = document.getElementById("stopToggle");
    const stopBadge = document.getElementById("stopBadge");

    const listEl = document.getElementById("productList");
    const cartEl = document.getElementById("cart");
    const totalEl = document.getElementById("total");
    const countPill = document.getElementById("countPill");

    const orderBtn = document.getElementById("orderBtn");
    const saveBtn = document.getElementById("saveBtn");
    const clearBtn = document.getElementById("clearBtn");

    const paySection = document.getElementById("paySection");
    const guestNote = document.getElementById("guestNote");
    const payTotalEl = document.getElementById("payTotal");
    const qrHost = document.getElementById("qrHost");

    const btnHost = document.getElementById("btnHost");
    const btnGuest = document.getElementById("btnGuest");

    // ===== çŠ¶æ…‹ =====
    let cart = loadCart();

    // ===== util =====
    function yen(n){ return "Â¥" + n.toLocaleString("ja-JP"); }

    function loadCart(){
      try{
        const raw = localStorage.getItem(LS_CART);
        if(!raw) return {};
        const obj = JSON.parse(raw);
        return (obj && typeof obj === "object") ? obj : {};
      }catch{
        return {};
      }
    }
    function persistCart(){ localStorage.setItem(LS_CART, JSON.stringify(cart)); }

    function qtyOf(id){ return cart[id] || 0; }
    function setQty(id, qty){
      if(qty <= 0) delete cart[id];
      else cart[id] = qty;
      persistCart();
      render();
    }

    function cartCount(){ return Object.values(cart).reduce((a,b)=>a+b,0); }
    function cartTotal(){
      let sum=0;
      for(const [id, qty] of Object.entries(cart)){
        const p = PRODUCTS.find(x=>x.id===id);
        if(p) sum += p.price * qty;
      }
      return sum;
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== åœæ­¢ä¸­ =====
    function isStopped(){ return (localStorage.getItem(LS_ORDER_STOP) || "1") === "1"; }
    function setStopped(v){
      localStorage.setItem(LS_ORDER_STOP, v ? "1" : "0");
      applyStopState();
      render(); // çŠ¶æ…‹ã«å¿œã˜ã¦ãƒœã‚¿ãƒ³åˆ¶å¾¡ã‚’æ›´æ–°
    }

    stopToggle.addEventListener("change", ()=>{
      setStopped(stopToggle.checked);
    });

    function applyStopState(){
      const stopped = isStopped();

      // ãƒã‚§ãƒƒã‚¯åŒæœŸ
      stopToggle.checked = stopped;

      // ãƒãƒƒã‚¸è¡¨ç¤º
      stopBadge.style.display = stopped ? "" : "none";

      // ç”»é¢å…¨ä½“ã®è¦‹ãŸç›®
      appRoot.classList.toggle("stopped", stopped);

      // ä¸»è¦æ“ä½œãƒœã‚¿ãƒ³ï¼ˆåœæ­¢ä¸­ã¯å…¨éƒ¨OFFï¼‰
      if(stopped){
        orderBtn.disabled = true;
        saveBtn.disabled = true;
        clearBtn.disabled = true;
      }
    }

    // ===== QRï¼ˆãƒ¢ãƒƒã‚¯ï¼šãã‚Œã£ã½ã„SVGï¼‰ =====
    function hash(str){
      let h = 2166136261;
      for(let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return (h>>>0);
    }
    function renderFakeQR(payload){
      const seed = hash(payload);
      const size = 21;
      const cell = 200 / size;
      let cells = "";

      function rect(x,y){
        return `<rect x="${x*cell}" y="${y*cell}" width="${cell}" height="${cell}" fill="#111827"/>`;
      }
      function on(x,y){
        const v = (seed + x*31 + y*17 + (x*y)*7) % 11;
        return v < 5;
      }
      function finder(x0,y0){
        const s=7;
        for(let y=0;y<s;y++){
          for(let x=0;x<s;x++){
            const border = x===0||y===0||x===s-1||y===s-1;
            const inner  = x>=2&&x<=4&&y>=2&&y<=4;
            if(border || inner) cells += rect(x0+x, y0+y);
          }
        }
      }

      for(let y=0;y<size;y++){
        for(let x=0;x<size;x++){
          const inFinder =
            (x<7 && y<7) || (x>=size-7 && y<7) || (x<7 && y>=size-7);
          if(inFinder) continue;
          if(on(x,y)) cells += rect(x,y);
        }
      }
      finder(0,0); finder(size-7,0); finder(0,size-7);

      return `
        <svg viewBox="0 0 200 200" width="200" height="200" role="img" aria-label="QR">
          <rect x="0" y="0" width="200" height="200" fill="#fff"/>
          ${cells}
        </svg>
      `;
    }

    // ===== role =====
    function getRole(){ return localStorage.getItem(LS_ROLE) || "host"; }
    function setRole(role){
      localStorage.setItem(LS_ROLE, role);
      renderRole();
      renderSettlement();
    }
    function renderRole(){
      const role = getRole();
      const isHost = role === "host";
      btnHost.classList.toggle("active", isHost);
      btnGuest.classList.toggle("active", !isHost);

      // å–ªä¸»ã®ã¿ï¼šç²¾ç®—è¡¨ç¤º
      paySection.style.display = isHost ? "" : "none";
      guestNote.style.display = isHost ? "none" : "";
    }

    btnHost.addEventListener("click", ()=>setRole("host"));
    btnGuest.addEventListener("click", ()=>setRole("guest"));

    // ===== render =====
    function renderProducts(){
      listEl.innerHTML = PRODUCTS.map(p => {
        const q = qtyOf(p.id);
        return `
          <div class="item">
            <div class="left">
              <div class="name">${escapeHtml(p.name)}</div>
              <div class="meta"><span class="price">${yen(p.price)}</span></div>
            </div>
            <div class="right">
              <div class="qty" aria-label="${escapeHtml(p.name)} æ•°é‡">
                <button type="button" data-act="minus" data-id="${p.id}" aria-label="æ¸›ã‚‰ã™">âˆ’</button>
                <div class="n">${q}</div>
                <button type="button" data-act="plus" data-id="${p.id}" aria-label="å¢—ã‚„ã™">ï¼‹</button>
              </div>
            </div>
          </div>
        `;
      }).join("");

      // åœæ­¢ä¸­ã¯ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹ï¼ˆCSS pointer-eventsã§æ­¢ã‚ã‚‹ãŒã€å¿µã®ãŸã‚ã“ã“ã§ã‚‚ã‚¬ãƒ¼ãƒ‰ï¼‰
      listEl.querySelectorAll("button[data-act]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          if(isStopped()) return;
          const id = btn.getAttribute("data-id");
          const act = btn.getAttribute("data-act");
          const cur = qtyOf(id);
          setQty(id, act === "plus" ? cur + 1 : Math.max(0, cur - 1));
        });
      });
    }

    function renderCart(){
      const entries = Object.entries(cart).filter(([id,qty])=>qty>0);

      countPill.textContent = `${cartCount()}ç‚¹`;
      totalEl.textContent = yen(cartTotal());

      const has = entries.length > 0;
      const stopped = isStopped();

      // ç¨¼åƒä¸­ã®ã¿ã€ã‚«ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆã«ãƒœã‚¿ãƒ³æœ‰åŠ¹
      orderBtn.disabled = stopped || !has;
      saveBtn.disabled  = stopped || !has;
      clearBtn.disabled = stopped || !has;

      if(!has){
        cartEl.innerHTML = `<div style="padding:12px;color:#6b7280;font-weight:800;">ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™ã€‚</div>`;
        return;
      }

      cartEl.innerHTML = entries.map(([id, qty])=>{
        const p = PRODUCTS.find(x=>x.id===id);
        if(!p) return "";
        const subtotal = p.price * qty;
        return `
          <div class="cartRow">
            <div class="cinfo">
              <div class="cname">${escapeHtml(p.name)}</div>
              <div class="csub">${yen(p.price)} Ã— ${qty} = ${yen(subtotal)}</div>
            </div>
            <div class="cright">
              <div class="qty" aria-label="${escapeHtml(p.name)} æ•°é‡">
                <button type="button" data-cact="minus" data-id="${id}" aria-label="æ¸›ã‚‰ã™">âˆ’</button>
                <div class="n">${qty}</div>
                <button type="button" data-cact="plus" data-id="${id}" aria-label="å¢—ã‚„ã™">ï¼‹</button>
              </div>
              <button class="del" type="button" data-del="${id}" aria-label="å‰Šé™¤">ğŸ—‘</button>
            </div>
          </div>
        `;
      }).join("");

      cartEl.querySelectorAll("button[data-cact]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          if(isStopped()) return;
          const id = btn.getAttribute("data-id");
          const act = btn.getAttribute("data-cact");
          const cur = qtyOf(id);
          setQty(id, act === "plus" ? cur + 1 : Math.max(0, cur - 1));
        });
      });

      cartEl.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          if(isStopped()) return;
          const id = btn.getAttribute("data-del");
          setQty(id, 0);
        });
      });
    }

    function renderSettlement(){
      const role = getRole();
      if(role !== "host") return;

      const total = cartTotal();
      payTotalEl.textContent = yen(total);

      const payId = `PAY|TOTAL=${total}|DATE=${new Date().toISOString().slice(0,10)}`;
      qrHost.innerHTML = renderFakeQR(payId);
    }

    function render(){
      applyStopState();
      renderRole();
      renderProducts();
      renderCart();
      renderSettlement();
    }

    // ===== actions =====
    orderBtn.addEventListener("click", ()=>{
      if(isStopped()) return;
      const total = cartTotal();
      alert(`æ³¨æ–‡ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰\nåˆè¨ˆï¼š${yen(total)}`);
      renderSettlement();
    });

    saveBtn.addEventListener("click", ()=>{
      if(isStopped()) return;
      persistCart();
      alert("æ³¨æ–‡å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰ã€‚");
      renderSettlement();
    });

    clearBtn.addEventListener("click", ()=>{
      if(isStopped()) return;
      cart = {};
      persistCart();
      render();
    });

    // åˆæœŸæç”»
    render();
  </script>
</body>
</html>
