<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>è‘¬å„€ãƒŸãƒ‹ã‚¢ãƒ—ãƒª</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --soft:#f9fafb;

      --title:22px;
      --label:20px;
      --sub:14px;

      --radius:18px;
      --shadow: 0 10px 30px rgba(17,24,39,.08);
      --tap: 76px;
      --max: 520px;

      --blue:#2563eb;
      --ok:#16a34a;
      --primary:#111827;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans JP", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .safe{
      padding:
        max(env(safe-area-inset-top), 18px)
        max(env(safe-area-inset-right), 18px)
        max(env(safe-area-inset-bottom), 18px)
        max(env(safe-area-inset-left), 18px);
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
    }

    /* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå´©ã‚Œå¯¾ç­–æ¸ˆã¿ï¼‰ ===== */
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:16px;
      flex-wrap:wrap; /* ç‹­ã„ç”»é¢ã¯è‡ªç„¶ã«æŠ˜ã‚Šè¿”ã™ */
    }

    .app-title{
      font-size:clamp(18px, 4.8vw, 22px);
      font-weight:900;
      line-height:1.2;
      white-space:nowrap;     /* å¤‰ãªä½ç½®ã§æ”¹è¡Œã•ã›ãªã„ */
      overflow:hidden;
      text-overflow:ellipsis;
      flex:1 1 auto;
      min-width:180px;
    }

    .right-head{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
      flex:0 0 auto;
    }

    .status{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border:1px solid var(--line);
      background: var(--soft);
      border-radius:999px;
      font-size:12px;
      font-weight:800;
      color: var(--muted);
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 0 5px rgba(34,197,94,.12);
    }

    /* ===== ã‚»ã‚°ï¼ˆå½“æ—¥/çŠ¶æ…‹ åˆ‡æ›¿ï¼‰ ===== */
    .seg{
      display:flex;
      gap:4px;
      align-items:center;
      background:#fff;
      border:1px solid var(--line);
      border-radius:12px;
      padding:4px;
      white-space:nowrap;
    }
    .seg .lbl{
      font-size:11px;
      font-weight:900;
      color:var(--muted);
      padding:0 6px 0 4px;
      white-space:nowrap;
    }
    .seg button{
      border:1px solid transparent;
      background:#fff;
      padding:6px 8px; /* å°‘ã—ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã—ã¦å´©ã‚Œã«ãã */
      border-radius:10px;
      font-size:12px;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    }
    .seg button.active{
      background: var(--primary);
      color:#fff;
      border-color: var(--primary);
    }
    .seg button:disabled{
      opacity:.45;
      cursor:not-allowed;
    }

    /* ===== ã‚«ãƒ¼ãƒ‰ ===== */
    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background:#fff;
      overflow:hidden;
    }

    .card-hd{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:linear-gradient(180deg,#fff,#fafafa);
    }
    .card-hd .h{
      font-size:16px;
      font-weight:900;
    }

    .menu{
      display:flex;
      flex-direction:column;
    }

    .item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px;
      min-height: var(--tap);
      border-bottom:1px solid var(--line);
      text-decoration:none;
      color: var(--text);
      background:#fff;
    }
    .item:last-child{ border-bottom:none; }
    .item.disabled{ opacity:.45; pointer-events:none; }

    .left{
      display:flex;
      gap:14px;
      align-items:center;
    }
    .icon{
      width:56px;height:56px;
      border-radius:18px;
      border:1px solid var(--line);
      display:grid;
      place-items:center;
      font-size:24px;
      background:#fff;
      box-shadow:0 8px 18px rgba(17,24,39,.06);
    }

    .text{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .label{
      font-size: var(--label);
      font-weight:900;
    }
    .sub{
      font-size: var(--sub);
      color: var(--muted);
      font-weight:800;
    }
    .note{
      font-size:12px;
      color:#9ca3af;
      font-weight:800;
    }

    .tag{
      display:inline-flex;
      gap:6px;
      align-items:center;
      font-size:12px;
      font-weight:900;
      color: var(--ok);
    }
    .tag .miniDot{
      width:8px;height:8px;border-radius:999px;
      background: var(--ok);
      box-shadow:0 0 0 5px rgba(22,163,74,.12);
    }

    .chev{
      font-size:26px;
      color:#9ca3af;
    }
  </style>
</head>

<body>
  <div class="safe">
    <div class="wrap">

      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="header">
        <div class="app-title">è‘¬å„€ãƒŸãƒ‹ã‚¢ãƒ—ãƒª</div>

        <div class="right-head">
          <!-- æ—¥ä»˜ -->
          <div class="seg" aria-label="å½“æ—¥åˆ‡æ›¿">
            <span class="lbl">æ—¥ä»˜</span>
            <button id="btnToday" type="button">å½“æ—¥</button>
            <button id="btnNotToday" type="button">å½“æ—¥ä»¥å¤–</button>
          </div>

          <!-- çŠ¶æ…‹ï¼ˆãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³åˆ‡æ›¿ï¼‰ -->
          <div class="seg" aria-label="ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³åˆ‡æ›¿">
            <span class="lbl">çŠ¶æ…‹</span>
            <button id="btnCheckedIn" type="button">ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ¸ˆ</button>
            <button id="btnNotCheckedIn" type="button">æœªãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³</button>
          </div>

          <div class="status">
            <span class="dot"></span>
            <span>DEV</span>
          </div>
        </div>
      </div>

      <!-- ãƒ›ãƒ¼ãƒ  -->
      <section class="card">
        <div class="card-hd">
          <div class="h">ãƒ›ãƒ¼ãƒ </div>
        </div>

        <nav class="menu">

          <!-- ãƒã‚¤ãƒšãƒ¼ã‚¸ï¼ˆå…ˆé ­ï¼‰ -->
          <a class="item" href="./mypage.html">
            <div class="left">
              <div class="icon">ğŸ‘¤</div>
              <div class="text">
                <div class="label">ãƒã‚¤ãƒšãƒ¼ã‚¸</div>
                <div class="sub">äºˆç´„æƒ…å ±ã®ç¢ºèª</div>
              </div>
            </div>
            <div class="chev">â€º</div>
          </a>

          <!-- ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ï¼ˆå½“æ—¥ã®ã¿æ´»æ€§ï¼‰ -->
          <a class="item" id="checkinItem" href="./checkin.html">
            <div class="left">
              <div class="icon">âœ…</div>
              <div class="text">
                <div class="label">ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³</div>
                <div class="sub" id="checkinSub">å½“æ—¥ã®å—ä»˜</div>
                <div class="note" id="checkinNote">â€»å½“æ—¥ä»¥å¤–ã¯éæ´»æ€§ã«ãªã‚Šã¾ã™</div>
                <div class="tag" id="checkinTag" style="display:none;">
                  <span class="miniDot"></span>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ¸ˆã¿
                </div>
              </div>
            </div>
            <div class="chev">â€º</div>
          </a>

          <!-- ã‚ªãƒ¼ãƒ€ãƒ¼ï¼ˆå½“æ—¥ã‹ã¤ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å¾Œã«æ´»æ€§ï¼‰ -->
          <a class="item" id="orderItem" href="./order.html">
            <div class="left">
              <div class="icon">ğŸ›’</div>
              <div class="text">
                <div class="label">ã‚ªãƒ¼ãƒ€ãƒ¼</div>
                <div class="sub">å£²åº—</div>
                <div class="note" id="orderNote">â€»ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å¾Œã«åˆ©ç”¨ã§ãã¾ã™</div>
              </div>
            </div>
            <div class="chev">â€º</div>
          </a>

          <!-- é¤¨å†…ãƒãƒƒãƒ—ï¼ˆå½“æ—¥ã‹ã¤ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å¾Œã«æ´»æ€§ï¼‰ -->
          <a class="item" id="mapItem" href="./map.html">
            <div class="left">
              <div class="icon">ğŸ—ºï¸</div>
              <div class="text">
                <div class="label">é¤¨å†…ãƒãƒƒãƒ—</div>
                <div class="sub">åœ°å›³ï¼å°ç·š</div>
                <div class="note" id="mapNote">â€»ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å¾Œã«åˆ©ç”¨ã§ãã¾ã™</div>
              </div>
            </div>
            <div class="chev">â€º</div>
          </a>

        </nav>
      </section>

    </div>
  </div>

  <script>
    // æœªç™»éŒ²ãªã‚‰å¿…ãšä¼šå“¡ç™»éŒ²ã¸ï¼ˆæ—¢å­˜è¸è¥²ï¼‰
    if(localStorage.getItem("miniapp_registered") !== "1"){
      location.replace("./register.html");
    }

    const DAY_KEY = "miniapp_day_mode";

    // checkin.html ã®ä¿å­˜ã‚­ãƒ¼æºã‚Œã«å¯¾å¿œï¼ˆäº’æ›ï¼‰
    const CHECKIN_KEYS = [
      "miniapp_checkin_done",        // æ—§
      "miniapp_checkin_done_v2",
      "miniapp_checkin_done_soft",
      "miniapp_checkin_done_force"
    ];
    const CANON_CHECKIN_KEY = "miniapp_checkin_done";

    const btnToday = document.getElementById("btnToday");
    const btnNotToday = document.getElementById("btnNotToday");

    const btnCheckedIn = document.getElementById("btnCheckedIn");
    const btnNotCheckedIn = document.getElementById("btnNotCheckedIn");

    const checkinItem = document.getElementById("checkinItem");
    const checkinNote = document.getElementById("checkinNote");
    const checkinTag  = document.getElementById("checkinTag");
    const checkinSub  = document.getElementById("checkinSub");

    const orderItem = document.getElementById("orderItem");
    const orderNote = document.getElementById("orderNote");
    const mapItem   = document.getElementById("mapItem");
    const mapNote   = document.getElementById("mapNote");

    function pad(n){ return String(n).padStart(2,"0"); }
    function nowText(){
      const now = new Date();
      return `${now.getFullYear()}/${pad(now.getMonth()+1)}/${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
    }

    function hasAnyCheckin(){
      for(const k of CHECKIN_KEYS){
        if(localStorage.getItem(k)) return true;
      }
      return false;
    }

    function clearAllCheckin(){
      CHECKIN_KEYS.forEach(k => localStorage.removeItem(k));
    }

    function setCheckinMock(){
      clearAllCheckin();
      localStorage.setItem(CANON_CHECKIN_KEY, JSON.stringify({
        checkedAt: nowText(),
        source: "home"
      }));
    }

    function render(mode){
      const today = mode === "today";
      const checkedIn = hasAnyCheckin();

      // æ—¥ä»˜ã‚¹ã‚¤ãƒƒãƒ
      btnToday.classList.toggle("active", today);
      btnNotToday.classList.toggle("active", !today);

      // çŠ¶æ…‹ã‚¹ã‚¤ãƒƒãƒ
      btnCheckedIn.classList.toggle("active", checkedIn);
      btnNotCheckedIn.classList.toggle("active", !checkedIn);

      // å½“æ—¥ã ã‘ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ´»æ€§ï¼ˆå½“æ—¥ä»¥å¤–ã¯éæ´»æ€§ï¼‰
      if(today){
        checkinItem.classList.remove("disabled");
        checkinNote.style.display = "none";
      }else{
        checkinItem.classList.add("disabled");
        checkinNote.style.display = "";
      }

      // ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ¸ˆã¿ã‚¿ã‚°
      if(checkedIn){
        checkinTag.style.display = "";
        checkinSub.textContent = "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ¸ˆã¿ï¼ˆç¢ºèªï¼‰";
      }else{
        checkinTag.style.display = "none";
        checkinSub.textContent = "å½“æ—¥ã®å—ä»˜";
      }

      // å½“æ—¥ & ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ¸ˆã¿ ã®ã¨ãã ã‘ã€ã‚ªãƒ¼ãƒ€ãƒ¼/é¤¨å†…ãƒãƒƒãƒ—æ´»æ€§
      if(today && checkedIn){
        orderItem.classList.remove("disabled");
        mapItem.classList.remove("disabled");
        orderNote.style.display = "none";
        mapNote.style.display = "none";
      }else{
        orderItem.classList.add("disabled");
        mapItem.classList.add("disabled");
        orderNote.style.display = "";
        mapNote.style.display = "";
      }
    }

    // åˆæœŸè¡¨ç¤º
    const saved = localStorage.getItem(DAY_KEY) || "not_today";
    render(saved);

    // æ—¥ä»˜åˆ‡æ›¿
    btnToday.onclick = () => {
      localStorage.setItem(DAY_KEY,"today");
      render("today");
    };
    btnNotToday.onclick = () => {
      localStorage.setItem(DAY_KEY,"not_today");
      render("not_today");
    };

    // çŠ¶æ…‹åˆ‡æ›¿ï¼ˆãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ / æœªãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ï¼‰
    btnCheckedIn.onclick = () => {
      setCheckinMock();
      render(localStorage.getItem(DAY_KEY) || "not_today");
      alert("ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ¸ˆã¿ã«ã—ã¾ã—ãŸï¼ˆãƒ¢ãƒƒã‚¯ï¼‰ã€‚");
    };
    btnNotCheckedIn.onclick = () => {
      clearAllCheckin();
      render(localStorage.getItem(DAY_KEY) || "not_today");
      alert("æœªãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã«æˆ»ã—ã¾ã—ãŸï¼ˆãƒ¢ãƒƒã‚¯ï¼‰ã€‚");
    };

    // checkin.html ã‹ã‚‰æˆ»ã£ã¦ããŸæ™‚ã«åæ˜ ï¼ˆLINE WebViewå¯¾ç­–ï¼‰
    window.addEventListener("pageshow", () => {
      render(localStorage.getItem(DAY_KEY) || "not_today");
    });
  </script>
</body>
</html>
